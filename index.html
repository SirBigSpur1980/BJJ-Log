<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BJJ Log</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  margin: 0;
  background: #121212;
  color: #fff;
}
header {
  padding: 20px;
  text-align: center;
  font-size: 24px;
  font-weight: bold;
  background: #1f1f1f;
  box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  position: sticky;
  top: 0;
  z-index: 10;
}
.container { padding: 15px; }
.search { width: 100%; padding: 14px; border-radius: 15px; border: none; margin-bottom: 15px; font-size: 16px; }
.entry {
  background: #1f2937;
  padding: 18px;
  margin-bottom: 12px;
  border-radius: 18px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}
.entry-info { flex:1; }
.date { font-size: 13px; color: #94a3b8; margin-bottom:4px; }
.tag { display: inline-block; padding: 5px 12px; border-radius: 12px; font-size: 13px; margin-top: 8px; font-weight: bold; }
.tag.Guard { background: #3b82f6; }
.tag.Passing { background: #10b981; }
.tag.Submissions { background: #ef4444; }
.tag.Escapes { background: #f97316; }
.tag.Other { background: #6b7280; }
.delete-btn, .edit-btn { border: none; color: #fff; padding: 8px 12px; border-radius: 10px; cursor: pointer; margin-left: 5px; font-size: 13px; margin-top:5px; }
.delete-btn { background: #ef4444; }
.edit-btn { background: #3b82f6; }
.add-btn {
  position: fixed;
  bottom: 25px;
  right: 25px;
  background: #22c55e;
  color: white;
  border: none;
  border-radius: 50%;
  width: 65px; height: 65px;
  font-size: 32px;
  box-shadow: 0 5px 10px rgba(0,0,0,0.3);
  cursor: pointer;
  z-index: 10;
}

/* Modal */
.modal { display: none; position: fixed; z-index: 20; left:0; top:0; width:100%; height:100%; backdrop-filter: blur(5px); background-color: rgba(0,0,0,0.5); }
.modal-content { background:#1f2937; margin:80px auto; padding:25px; border-radius:20px; width:90%; max-width:400px; box-shadow:0 5px 15px rgba(0,0,0,0.4); }
.modal-content textarea, .modal-content select, .modal-content button, .modal-content input { width:100%; padding:14px; border-radius:15px; border:none; margin-bottom:14px; font-size:17px; }
.modal-content textarea { height:120px; }
.modal-content button { width:100%; padding:16px; border-radius:15px; border:none; font-weight:bold; font-size:17px; background:#22c55e; color:white; cursor:pointer; }

/* Collapsible note preview (first line) */
.note-preview {
  overflow: hidden;
  cursor: pointer;
  display: -webkit-box;
  -webkit-line-clamp: 1;      /* show only first line */
  -webkit-box-orient: vertical;
  white-space: normal;         /* allow wrapping */
  text-overflow: ellipsis;
}
.note-preview.expanded {
  display: block;
  white-space: pre-wrap;       /* show full text with line breaks */
}
</style>
</head>
<body>

<header>BJJ Training Log</header>

<div class="container" id="listView">
  <input class="search" id="search" placeholder="Search or filter..." oninput="render()">
  <div id="log"></div>
</div>

<button class="add-btn" onclick="openModal()">+</button>

<div class="modal" id="modal">
  <div class="modal-content">
    <label for="sessionDate">Session Date:</label>
    <input type="date" id="sessionDate">
    <select id="tag">
      <option>Guard</option>
      <option>Passing</option>
      <option>Submissions</option>
      <option>Escapes</option>
      <option>Other</option>
    </select>
    <textarea id="note" placeholder="What did you work on today?"></textarea>
    <button onclick="saveEntry()">Save Session</button>
  </div>
</div>

<script>
let editingIndex = null;

// Get/save from local storage
function getEntries(){ return JSON.parse(localStorage.getItem("bjj_log_simple")||"[]"); }
function saveEntries(entries){ localStorage.setItem("bjj_log_simple", JSON.stringify(entries)); }

// Modal open/close
function openModal(tag='', note='', index=null, date=''){
  document.getElementById("modal").style.display="block";
  document.getElementById("tag").value = tag;
  document.getElementById("note").value = note;

  // Default date to today if new session
  if(date){
    document.getElementById("sessionDate").value = date;
  } else {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById("sessionDate").value = today;
  }

  editingIndex = index;
}
function closeModal(){ document.getElementById("modal").style.display="none"; editingIndex=null; }

// Save or edit entry
function saveEntry(){
  const note = document.getElementById("note").value;
  const tag = document.getElementById("tag").value;
  const date = document.getElementById("sessionDate").value;
  if(!note || !date) { alert("Please add a date and note."); return; }

  const entries = getEntries();
  const entryData = { date: date, tag, note };
  
  if(editingIndex!==null){
    entries[editingIndex] = entryData;
  } else {
    entries.push(entryData);
  }

  saveEntries(entries);
  closeModal();
  render();
}

// Delete entry
function deleteEntry(i){
  const entries = getEntries();
  entries.splice(i,1);
  saveEntries(entries);
  render();
}

// Format date nicely
function formatDate(dateStr){
  const d = new Date(dateStr);
  const options = { year: 'numeric', month: 'short', day: 'numeric' };
  return d.toLocaleDateString(undefined, options);
}

// Render list
function render(){
  const log = document.getElementById("log");
  const search = document.getElementById("search").value.toLowerCase();
  let entries = getEntries();

  // Sort by date descending
  entries.sort((a,b) => new Date(b.date) - new Date(a.date));

  log.innerHTML = "";
  entries.filter(e => e.note.toLowerCase().includes(search) || e.tag.toLowerCase().includes(search))
    .forEach((e,i)=>{
      const div = document.createElement("div"); div.className="entry";

      // Entry info
      const entryInfo = document.createElement("div");
      entryInfo.className = "entry-info";

      const dateDiv = document.createElement("div");
      dateDiv.className = "date";
      dateDiv.textContent = formatDate(e.date);

      const tagDiv = document.createElement("div");
      tagDiv.className = "tag " + e.tag.replace(/\s/g,'');
      tagDiv.textContent = e.tag;

      // Collapsible note preview (first line, wraps)
      const noteDiv = document.createElement("div");
      noteDiv.className = "note-preview";
      noteDiv.textContent = e.note;
      noteDiv.onclick = () => noteDiv.classList.toggle("expanded");

      entryInfo.appendChild(dateDiv);
      entryInfo.appendChild(tagDiv);
      entryInfo.appendChild(noteDiv);

      div.appendChild(entryInfo);

      // Buttons
      const editBtn = document.createElement("button");
      editBtn.className = "edit-btn";
      editBtn.textContent = "Edit";
      editBtn.onclick = () => openModal(e.tag, e.note, i, e.date);

      const deleteBtn = document.createElement("button");
      deleteBtn.className = "delete-btn";
      deleteBtn.textContent = "Delete";
      deleteBtn.onclick = () => deleteEntry(i);

      div.appendChild(editBtn);
      div.appendChild(deleteBtn);

      log.appendChild(div);
    });
}

render();

// Close modal if click outside
window.onclick = function(event){
  if(event.target==document.getElementById("modal")) closeModal();
};
</script>

</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BJJ Log Calendar</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  margin: 0;
  background: #121212;
  color: #fff;
}
header {
  padding: 20px;
  text-align: center;
  font-size: 24px;
  font-weight: bold;
  background: #1f1f1f;
  box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  position: sticky;
  top: 0;
  z-index: 10;
}
.view-toggle {
  display: flex;
  justify-content: center;
  margin-top: 10px;
}
.view-toggle button {
  margin: 0 5px;
  padding: 8px 16px;
  border-radius: 12px;
  border: none;
  font-weight: bold;
  cursor: pointer;
}
.view-toggle .active { background: #22c55e; color: #fff; }

.container {
  padding: 15px;
}
.search { width: 100%; padding: 12px; border-radius: 12px; border: none; margin-bottom: 15px; font-size: 16px; }

.entry {
  background: #1f2937;
  padding: 15px;
  margin-bottom: 12px;
  border-radius: 15px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.entry-info { flex:1; }
.date { font-size: 12px; color: #94a3b8; }
.tag {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 10px;
  font-size: 12px;
  margin-top: 8px;
  font-weight: bold;
}
.tag.Guard { background: #3b82f6; }
.tag.Passing { background: #10b981; }
.tag.Submissions { background: #ef4444; }
.tag.Escapes { background: #f97316; }
.tag.Other { background: #6b7280; }

.delete-btn { background: #ef4444; border: none; color: #fff; padding: 6px 10px; border-radius: 8px; cursor: pointer; margin-left: 10px; font-size: 12px; }

.add-btn {
  position: fixed;
  bottom: 25px;
  right: 25px;
  background: #22c55e;
  color: white;
  border: none;
  border-radius: 50%;
  width: 60px; height: 60px;
  font-size: 30px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  cursor: pointer;
  z-index: 10;
}

.modal {
  display: none;
  position: fixed;
  z-index: 20;
  left:0; top:0;
  width:100%; height:100%;
  backdrop-filter: blur(5px);
  background-color: rgba(0,0,0,0.5);
}
.modal-content {
  background:#1f2937;
  margin:100px auto;
  padding:20px;
  border-radius:15px;
  width:90%;
  max-width:400px;
}
.modal-content textarea, .modal-content select { width:100%; padding:12px; border-radius:12px; border:none; margin-bottom:12px; font-size:16px; }
.modal-content button { width:100%; padding:14px; border-radius:12px; border:none; font-weight:bold; font-size:16px; background:#22c55e; color:white; }

.calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap:5px;
  margin-top:15px;
}
.day {
  background:#1f2937;
  border-radius:10px;
  padding:10px;
  text-align:center;
  font-size:14px;
  cursor:pointer;
  position:relative;
}
.day.has-session { background:#22c55e; }
.day .day-number { font-weight:bold; }
.day .day-sessions { font-size:10px; margin-top:3px; }

</style>
</head>
<body>

<header>BJJ Training Log</header>

<div class="view-toggle">
  <button id="listViewBtn" class="active" onclick="showView('list')">List View</button>
  <button id="calendarViewBtn" onclick="showView('calendar')">Calendar View</button>
</div>

<div class="container" id="listView">
  <input class="search" id="search" placeholder="Search or filter..." oninput="render()">
  <div id="log"></div>
</div>

<div class="container" id="calendarView" style="display:none">
  <div id="calendar"></div>
</div>

<button class="add-btn" onclick="openModal()">+</button>

<div class="modal" id="modal">
  <div class="modal-content">
    <select id="tag">
      <option>Guard</option>
      <option>Passing</option>
      <option>Submissions</option>
      <option>Escapes</option>
      <option>Other</option>
    </select>
    <textarea id="note" placeholder="What did you work on today?"></textarea>
    <button onclick="saveEntry()">Save Session</button>
  </div>
</div>

<script>
// Data functions
function getEntries() { return JSON.parse(localStorage.getItem("bjj_log_v4")||"[]"); }
function saveEntries(entries) { localStorage.setItem("bjj_log_v4", JSON.stringify(entries)); }

// Modal
function openModal(){document.getElementById("modal").style.display="block";}
function closeModal(){document.getElementById("modal").style.display="none";}

// Save entry
function saveEntry(){
  const note=document.getElementById("note").value;
  const tag=document.getElementById("tag").value;
  if(!note)return;
  const entries=getEntries();
  entries.unshift({date:new Date().toLocaleString(), tag, note});
  saveEntries(entries);
  document.getElementById("note").value="";
  closeModal();
  render();
  renderCalendar();
}

// Delete entry
function deleteEntry(i){const entries=getEntries(); entries.splice(i,1); saveEntries(entries); render(); renderCalendar();}

// Render List
function render(){
  const log=document.getElementById("log");
  const search=document.getElementById("search").value.toLowerCase();
  const entries=getEntries();
  log.innerHTML="";
  entries.filter(e=>e.note.toLowerCase().includes(search)||e.tag.toLowerCase().includes(search))
         .forEach((e,i)=>{
           const div=document.createElement("div");
           div.className="entry";
           div.innerHTML=`
             <div class="entry-info">
               <div class="date">${e.date}</div>
               <div class="tag ${e.tag.replace(/\s/g,'')}">${e.tag}</div>
               <div>${e.note}</div>
             </div>
             <button class="delete-btn" onclick="deleteEntry(${i})">Delete</button>
           `;
           log.appendChild(div);
         });
}

// Toggle views
function showView(view){
  document.getElementById('listView').style.display=view==='list'?'block':'none';
  document.getElementById('calendarView').style.display=view==='calendar'?'block':'none';
  document.getElementById('listViewBtn').classList.toggle('active',view==='list');
  document.getElementById('calendarViewBtn').classList.toggle('active',view==='calendar');
}

// Render calendar
function renderCalendar(){
  const calendar=document.getElementById("calendar");
  calendar.innerHTML="";
  const entries=getEntries();
  const now=new Date();
  const year=now.getFullYear(), month=now.getMonth();
  const firstDay=new Date(year,month,1).getDay();
  const daysInMonth=new Date(year,month+1,0).getDate();

  for(let i=0;i<firstDay;i++){
    const empty=document.createElement("div"); calendar.appendChild(empty);
  }

  for(let day=1;day<=daysInMonth;day++){
    const dayDiv=document.createElement("div"); dayDiv.className="day";
    const dayNumber=document.createElement("div"); dayNumber.className="day-number"; dayNumber.innerText=day;
    dayDiv.appendChild(dayNumber);

    const dayStr=`${month+1}/${day}/${year}`;
    const daySessions=entries.filter(e=>new Date(e.date).toLocaleDateString()===dayStr);
    if(daySessions.length>0){ dayDiv.classList.add("has-session"); }

    const sessionDiv=document.createElement("div"); sessionDiv.className="day-sessions";
    sessionDiv.innerHTML=daySessions.map(s=>`${s.tag}: ${s.note}`).join("<br>");
    dayDiv.appendChild(sessionDiv);

    calendar.appendChild(dayDiv);
  }
}

render();
renderCalendar();

// Close modal if click outside
window.onclick=function(event){if(event.target==document.getElementById("modal"))closeModal();}
</script>
</body>
</html>

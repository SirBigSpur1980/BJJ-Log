<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BJJ Log Calendar</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  margin: 0;
  background: #121212;
  color: #fff;
}
header {
  padding: 20px;
  text-align: center;
  font-size: 24px;
  font-weight: bold;
  background: #1f1f1f;
  box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  position: sticky;
  top: 0;
  z-index: 10;
}

.view-toggle {
  display: flex;
  justify-content: center;
  margin-top: 10px;
}
.view-toggle button {
  margin: 0 5px;
  padding: 8px 16px;
  border-radius: 12px;
  border: none;
  font-weight: bold;
  cursor: pointer;
}
.view-toggle .active { background: #22c55e; color: #fff; }

.container {
  padding: 15px;
}
.search { width: 100%; padding: 12px; border-radius: 12px; border: none; margin-bottom: 15px; font-size: 16px; }

.entry {
  background: #1f2937;
  padding: 15px;
  margin-bottom: 12px;
  border-radius: 15px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.entry-info { flex:1; }
.date { font-size: 12px; color: #94a3b8; }
.tag {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 10px;
  font-size: 12px;
  margin-top: 8px;
  font-weight: bold;
}
.tag.Guard { background: #3b82f6; }
.tag.Passing { background: #10b981; }
.tag.Submissions { background: #ef4444; }
.tag.Escapes { background: #f97316; }
.tag.Other { background: #6b7280; }

.delete-btn { background: #ef4444; border: none; color: #fff; padding: 6px 10px; border-radius: 8px; cursor: pointer; margin-left: 10px; font-size: 12px; }

.add-btn {
  position: fixed;
  bottom: 25px;
  right: 25px;
  background: #22c55e;
  color: white;
  border: none;
  border-radius: 50%;
  width: 60px; height: 60px;
  font-size: 30px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  cursor: pointer;
  z-index: 10;
}

.modal, .day-modal {
  display: none;
  position: fixed;
  z-index: 20;
  left:0; top:0;
  width:100%; height:100%;
  backdrop-filter: blur(5px);
  background-color: rgba(0,0,0,0.5);
}
.modal-content, .day-modal-content {
  background:#1f2937;
  margin:100px auto;
  padding:20px;
  border-radius:15px;
  width:90%;
  max-width:400px;
}
.modal-content textarea, .modal-content select, .day-modal-content button { width:100%; padding:12px; border-radius:12px; border:none; margin-bottom:12px; font-size:16px; }
.modal-content button, .day-modal-content button { width:100%; padding:14px; border-radius:12px; border:none; font-weight:bold; font-size:16px; background:#22c55e; color:white; cursor:pointer; }

/* Calendar Styling */
.calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 5px;
  margin-top: 10px;
}
.weekday {
  text-align: center;
  font-weight: bold;
  font-size: 14px;
  padding: 5px 0;
}
.day {
  background:#1f2937;
  border-radius:10px;
  padding:10px;
  text-align:center;
  font-size:14px;
  cursor:pointer;
  position:relative;
  min-height:60px;
}
.day.today { border: 2px solid #22c55e; }
.day.has-session { background:#22c55e; }
.day .day-number { font-weight:bold; margin-bottom:5px; }
.day .day-sessions { font-size:10px; margin-top:3px; overflow:hidden; text-overflow:ellipsis; }

.month-nav {
  display:flex;
  justify-content: space-between;
  align-items:center;
  font-weight:bold;
  margin-bottom:5px;
}
.month-nav button { background:#22c55e; border:none; color:#fff; padding:5px 10px; border-radius:8px; cursor:pointer; }

</style>
</head>
<body>

<header>BJJ Training Log</header>

<div class="view-toggle">
  <button id="listViewBtn" class="active" onclick="showView('list')">List View</button>
  <button id="calendarViewBtn" onclick="showView('calendar')">Calendar View</button>
</div>

<div class="container" id="listView">
  <input class="search" id="search" placeholder="Search or filter..." oninput="render()">
  <div id="log"></div>
</div>

<div class="container" id="calendarView" style="display:none">
  <div class="month-nav">
    <button onclick="changeMonth(-1)">&lt;</button>
    <div id="monthYear"></div>
    <button onclick="changeMonth(1)">&gt;</button>
  </div>
  <div class="calendar" id="calendarWeekdays"></div>
  <div class="calendar" id="calendarDays"></div>
</div>

<button class="add-btn" onclick="openModal()">+</button>

<!-- Add session modal -->
<div class="modal" id="modal">
  <div class="modal-content">
    <select id="tag">
      <option>Guard</option>
      <option>Passing</option>
      <option>Submissions</option>
      <option>Escapes</option>
      <option>Other</option>
    </select>
    <textarea id="note" placeholder="What did you work on today?"></textarea>
    <button onclick="saveEntry()">Save Session</button>
  </div>
</div>

<!-- Day details modal -->
<div class="day-modal" id="dayModal">
  <div class="day-modal-content" id="dayModalContent">
    <button onclick="closeDayModal()">Close</button>
  </div>
</div>

<script>
let currentDate = new Date();
function getEntries(){return JSON.parse(localStorage.getItem("bjj_log_v6")||"[]");}
function saveEntries(entries){localStorage.setItem("bjj_log_v6", JSON.stringify(entries));}

// Modals
function openModal(){document.getElementById("modal").style.display="block";}
function closeModal(){document.getElementById("modal").style.display="none";}
function openDayModal(content){
  const modal=document.getElementById("dayModal");
  const container=document.getElementById("dayModalContent");
  container.innerHTML=content+'<button onclick="closeDayModal()">Close</button>';
  modal.style.display="block";
}
function closeDayModal(){document.getElementById("dayModal").style.display="none";}

// Add entry
function saveEntry(){
  const note=document.getElementById("note").value;
  const tag=document.getElementById("tag").value;
  if(!note)return;
  const entries=getEntries();
  entries.unshift({date:new Date().toLocaleString(), tag, note});
  saveEntries(entries);
  document.getElementById("note").value="";
  closeModal();
  render();
  renderCalendar();
}

// Delete entry
function deleteEntry(i){const entries=getEntries(); entries.splice(i,1); saveEntries(entries); render(); renderCalendar();}

// Render List View
function render(){
  const log=document.getElementById("log");
  const search=document.getElementById("search").value.toLowerCase();
  const entries=getEntries();
  log.innerHTML="";
  entries.filter(e=>e.note.toLowerCase().includes(search)||e.tag.toLowerCase().includes(search))
    .forEach((e,i)=>{
      const div=document.createElement("div");
      div.className="entry";
      div.innerHTML=`
      <div class="entry-info">
        <div class="date">${e.date}</div>
        <div class="tag ${e.tag.replace(/\s/g,'')}">${e.tag}</div>
        <div>${e.note}</div>
      </div>
      <button class="delete-btn" onclick="deleteEntry(${i})">Delete</button>`;
      log.appendChild(div);
    });
}

// Toggle views
function showView(view){
  document.getElementById('listView').style.display=view==='list'?'block':'none';
  document.getElementById('calendarView').style.display=view==='calendar'?'block':'none';
  document.getElementById('listViewBtn').classList.toggle('active',view==='list');
  document.getElementById('calendarViewBtn').classList.toggle('active',view==='calendar');
}

// Calendar navigation
function changeMonth(offset){
  currentDate.setMonth(currentDate.getMonth()+offset);
  renderCalendar();
}

// Render Calendar
function renderCalendar(){
  const entries=getEntries();
  const calendarWeekdays=document.getElementById("calendarWeekdays");
  const calendarDays=document.getElementById("calendarDays");
  calendarWeekdays.innerHTML="";
  calendarDays.innerHTML="";
  
  const weekdays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
  weekdays.forEach(d=>{
    const wd=document.createElement("div"); wd.className="weekday"; wd.innerText=d;
    calendarWeekdays.appendChild(wd);
  });

  const year=currentDate.getFullYear(), month=currentDate.getMonth();
  const firstDay=new Date(year,month,1).getDay();
  const daysInMonth=new Date(year,month+1,0).getDate();

  document.getElementById("monthYear").innerText = currentDate.toLocaleString('default',{month:'long', year:'numeric'});

  for(let i=0;i<firstDay;i++){calendarDays.appendChild(document.createElement("div"));}

  for(let day=1; day<=daysInMonth; day++){
    const dayDiv=document.createElement("div"); dayDiv.className="day";
    const dayNumber=document.createElement("div"); dayNumber.className="day-number"; dayNumber.innerText=day;
    dayDiv.appendChild(dayNumber);

    const dayStr=`${month+1}/${day}/${year}`;
    const daySessions=entries.filter(e=>new Date(e.date).toLocaleDateString()===dayStr);
    if(daySessions.length>0){dayDiv.classList.add("has-session");}

    const today=new Date();
    if(day===today.getDate() && month===today.getMonth() && year===today.getFullYear()){dayDiv.classList.add("today");}

    dayDiv.onclick=function(){
      if(daySessions.length>0){
        const content=daySessions.map(s=>`${s.tag}: ${s.note} <button onclick="deleteEntry(${entries.indexOf(s)}); closeDayModal(); renderCalendar()">Delete</button>`).join("<br>");
        openDayModal(content);
      }
    };

    calendarDays.appendChild(dayDiv);
  }
}

render();
renderCalendar();

// Close modals when clicking outside
window.onclick=function(event){
  if(event.target==document.getElementById("modal")) closeModal();
  if(event.target==document.getElementById("dayModal")) closeDayModal();
};
</script>
</body>
</html>
